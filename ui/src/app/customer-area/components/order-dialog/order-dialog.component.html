<mat-dialog-content>
  <mat-vertical-stepper #stepper linear="true">

    <mat-step [stepControl]="authenticationForm" [completed]="authentication">
        <form [formGroup]="authenticationForm">
        <ng-template matStepLabel>{{authenticationStepLabel}}</ng-template>
        <div *ngIf="!authentication">
          <mat-radio-group (change)="changeAuthentificationType($event)">
            <mat-radio-button value="true" checked="true">J'ai déjà un compte</mat-radio-button>
            <mat-radio-button value="false">Je n'ai pas de compte</mat-radio-button>
          </mat-radio-group>
        </div>

        <div *ngIf="authentication">
          <button mat-flat-button matStepperNext color="accent">Poursuivre avec ce compte</button>
          <button mat-flat-button (click)="logout()">Se déconnecter et changer de compte</button>
        </div>

        <div *ngIf="!authentication && existingAccount">
          <div>
            <mat-form-field>
              <mat-label>Adresse mail</mat-label>
              <input type="email" matInput formControlName="existingEmail" required>
            </mat-form-field>
            <span *ngIf="isErrorMessageDisplayed('existingEmail', 'email', true)">
              L'email est erroné.
            </span>
          </div>
          <div>
            <mat-form-field>
              <mat-label>Mot de passe</mat-label>
              <input type="password" matInput formControlName="existingPassword" required>
            </mat-form-field>
          </div>
          <div>
            <button
              [disabled]="!areFormFieldsValid(['existingEmail', 'existingPassword'])"
              mat-flat-button color="accent"
              (click)="login(authenticationForm.value.existingEmail, authenticationForm.value.existingPassword)">
              Se connecter
            </button>
            <div *ngIf="authenticationFailureMessage">
              {{authenticationFailureMessage}}
            </div>
          </div>
        </div>

        <div *ngIf="!authentication && !existingAccount">
          <div>
            <mat-form-field>
              <mat-label>Prénom</mat-label>
              <input matInput formControlName="creatingFirstName" required>
            </mat-form-field>
            <span *ngIf="isErrorMessageDisplayed('creatingFirstName', 'required')">
              Le prénom est obligatoire.
            </span>
          </div>
          <div>
          <mat-form-field>
            <mat-label>Nom</mat-label>
            <input matInput formControlName="creatingName" required>
          </mat-form-field>
          <span *ngIf="isErrorMessageDisplayed('creatingName', 'required')">
            Le nom est obligatoire.
          </span>
          </div>
          <div>
            <mat-form-field>
              <mat-label>Adresse mail</mat-label>
              <input type="email" matInput formControlName="creatingEmail" required>
            </mat-form-field>
            <span *ngIf="isErrorMessageDisplayed('creatingEmail', 'required')">
              L'email est obligatoire.
            </span>
            <span *ngIf="isErrorMessageDisplayed('creatingEmail', 'email', true)">
              L'email est erroné.
            </span>
          </div>
          <div>
            <mat-form-field>
              <mat-label>Téléphone mobile</mat-label>
              <input type="tel" matInput formControlName="creatingPhone" required>
            </mat-form-field>
            <span *ngIf="isErrorMessageDisplayed('creatingPhone', 'required')">
              Le téléphone est obligatoire.
            </span>
          </div>
          <div>
            <mat-form-field>
              <mat-label>Mot de passe</mat-label>
              <input type="password" matInput formControlName="creatingPassword" required minlength="6">
            </mat-form-field>
            <span *ngIf="isErrorMessageDisplayed('creatingPassword', 'required')">
              Le mot de passe est obligatoire.
            </span>
            <span *ngIf="isErrorMessageDisplayed('creatingPassword', 'minlength', true)">
              Le mot de passe doit avoir au moins 6 caractères.
            </span>
          </div>
          <div>
            <mat-form-field>
              <mat-label>Confirmez le mot de passe</mat-label>
              <input type="password" matInput formControlName="creatingPasswordConfirmed" required>
            </mat-form-field>
            <span *ngIf="isErrorMessageDisplayed('creatingPassword', 'required')">
              La confirmation du mot de passe est obligatoire.
            </span>
            <span *ngIf="authenticationForm.errors?.passwordConfirmationFailed && authenticationForm.get('creatingPasswordConfirmed').touched">
              La confirmation du mot de passe est différente du mot de passe.
            </span>
          </div>
          <div>
            <button
              mat-flat-button color="accent"
              (click)="createCustomerAccount()"
              [disabled]="!areFormFieldsValid(['creatingFirstName', 'creatingName', 'creatingEmail', 'creatingPhone', 'creatingPassword', 'creatingPasswordConfirmed'])">
                Créer un compte
            </button>
            <div *ngIf="accountCreationFailureMessage">
              {{accountCreationFailureMessage}}
            </div>
          </div>
        </div>
      </form>
    </mat-step>

    <mat-step [stepControl]="productSelectionForm" >
      <form [formGroup]="productSelectionForm">
        <ng-template matStepLabel>Sélectionnez la quantité de viande commandée (en kg)</ng-template>
        <mat-form-field>
          <input matInput formControlName="quantity">
          <mat-slider min="5" max="50" step="1" tickInterval="5" thumbLabel #quantitySlider (change)="setQuantity($event)"></mat-slider>
        </mat-form-field>
      </form>
    </mat-step>

    <mat-step [stepControl]="paymentForm">
      <form [formGroup]="paymentForm">
        <ng-template matStepLabel>Procédez au paiement</ng-template>
        <mat-form-field>
          <input matInput formControlName="payed" hidden="true">
          <button mat-flat-button color="accent">Accéder au paiement</button>
        </mat-form-field>
      </form>
    </mat-step>

  </mat-vertical-stepper>
</mat-dialog-content>

<mat-dialog-actions>
  <button mat-button [mat-dialog-close]="true" cdkFocusInitial disabled="!orderStored">C'est commandé !</button>
  <button mat-button mat-dialog-close>Annuler la commande</button>
</mat-dialog-actions>
